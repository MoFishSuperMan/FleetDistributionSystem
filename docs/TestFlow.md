# 智慧物流车队与配送管理系统 - 测试流程说明

本文档基于 `condition.txt` 的设计要求，针对广州物流中心模拟环境制定详细测试流程。请按照以下步骤验证系统功能。

> **前置条件**：请确保已在 SQL Server 中执行了最新的 `SQLCode/07_data.sql` 脚本，初始化了广州物流中心数据。

---

## 1. 角色与登录信息 (用于测试)

| 角色 | 账号 | 密码 | 对应车队/说明 |
| :--- | :--- | :--- | :--- |
| **超级管理员** | `admin` | `admin123` | 系统全局权限 |
| **调度主管A** | `DP001` | `123456` | 广州快运队 (主要测试对象) |
| **调度主管B** | `DP002` | `123456` | 华南重卡队 |
| **测试主管** | `DP000` | `123456` | 测试专用队 |
| **司机** | `DR001` | `123456` | 广州快运队 (陈师傅) |

---

## 2. 功能验证流程

### 场景一：基础数据管理与审计 (Requirement 1 & 7 - Audit Log)

**目的**：验证基本信息的增删改查，以及**修改敏感信息触发审计日志**的功能。

1.  **登录系统**：使用 `DP001` / `123456` 登录。
2.  **修改司机信息**：
    *   进入 **[司机管理]** 页面。
    *   找到 `DR001 (陈师傅)`，点击 **[编辑]**。
    *   将 **驾照等级** 从 `C1` 修改为 `B1`，点击保存。
    *   *验证*：列表显示更新后的驾照等级。
3.  **查看审计日志**：
    *   点击顶部导航栏 **[审计日志]** (需调度主管权限)。
    *   *验证*：列表中出现一条新记录，`table_name` 为 `Driver`，`column_name` 为 `license_level`，旧值 `C1`，新值 `B1`。

### 场景二：运单分配与自动载重校验 (Requirement 2 - Trigger Check)

**目的**：验证将运单分配给车辆时，触发器是否能拦截超载请求。

1.  **正常分配**：
    *   进入 **[运单分配]** 页面。
    *   找到待分配运单 `ORD-GZ-001` (3.5吨)。
    *   点击 **[分配]**，在弹窗中选择车辆 `粤A-00001` (空闲，载重上限5吨)。
    *   选择司机 `DR001`，点击提交。
    *   *验证*：分配成功，运单状态变为 `Pending` (或 `Loading`，视业务逻辑初始值而定)，车辆列表显示该车已被占用 (若逻辑设定分配即占用)。
2.  **超载拦截**：
    *   在 **[运单分配]** 页面，找到运单 `ORD-GZ-002` (10吨)。
    *   尝试将其分配给车辆 `粤A-00002` (载重上限仅2吨)。
    *   点击提交。
    *   *验证*：**系统应报错提示 "Vehicle overload! Max weight exceeded"** (这是触发器 `TRG_Load_Check` 抛出的错误，前端应捕获并显示)。

### 场景三：异常录入与车辆状态锁定 (Requirement 3 & 3.3 - Exception Trigger)

**目的**：验证录入异常后，车辆状态是否自动变为“异常 (Exception)”。

1.  **录入异常**：
    *   进入 **[异常管理]** 页面。
    *   点击 **[新增异常]**。
    *   选择车辆 `粤A-00001` (刚才分配过的正常车辆)，司机 `DR001`。
    *   类型选择 `Transit_Exception` (运输中异常)，状态 `Unprocessed`。
    *   填写任意罚款金额（如 100），点击保存。
2.  **验证状态**：
    *   进入 **[车辆管理]** 页面。
    *   *验证*：车辆 `粤A-00001` 的状态已自动变为 **异常 (Exception)**。这是触发器 `TRG_Exception_Flag` 的作用。

### 场景四：异常处理与状态智能恢复 (Requirement 3.3 - Auto Recovery)

**目的**：验证异常处理完毕后，车辆状态是否自动恢复。

1.  **处理异常**：
    *   回到 **[异常管理]** 页面。
    *   找到刚才录入的 `粤A-00001` 的异常记录。
    *   点击状态列的 **[处理]** (或编辑将其改为 `Processed`)。
2.  **验证恢复**：
    *   进入 **[车辆管理]** 页面。
    *   *验证*：车辆 `粤A-00001` 的状态应恢复为 **运输中 (Busy)** (因为它身上还有未完成的运单 `ORD-GZ-001`)。
    *   *逻辑说明*：触发器 `TRG_Exception_Recovery` 会检查车辆是否有未完成运单，若有则恢复为 Busy，若无则恢复为 Idle。
3.  **审计验证**：
    *   再次查看 **[审计日志]**。
    *   *验证*：应有一条 `Exception_Record` 的 `handle_status` 从 `Unprocessed` 变为 `Processed` 的记录。

### 场景五：状态自动流转 - 完结运单 (Requirement 3.3 - Auto Idle)

**目的**：验证运单全部完成后，车辆自动变为空闲。

1.  **更新运单状态**：
    *   进入 **[运单分配]** 或 **[司机只读页]** (模拟司机操作)。
    *   为方便测试，可在主管的 **[运单页面]** 直接编辑 `ORD-GZ-001`。
    *   将运单状态修改为 **已送达 (Delivered)**。
2.  **验证车辆释放**：
    *   进入 **[车辆管理]** 页面。
    *   *验证*：车辆 `粤A-00001` 的状态已自动变回 **空闲 (Idle)**。这是触发器 `TRG_Auto_Status_Update` 的作用。

### 场景六：车队资源查询与报表 (Requirement 4, 5, 6)

1.  **资源总览**：
    *   点击 **[仪表盘 (Dashboard)]**。
    *   *验证*：查看车辆状态统计图表（空闲、忙碌、异常的数量分布）。
    *   *验证*：应能看到 `粤A-00004` 处于异常状态，`粤B-99999` 处于维修状态。
2.  **报表查询**：
    *   点击 **[报表查询]**。
    *   选择时间范围（覆盖过去一个月）。
    *   *验证*：应能统计出 `DR001` 的历史运单数 (根据 `SQLCode/07_data.sql` 中的历史数据) 和异常罚款总额。

---

## 3. 辅助测试 (超级管理员视角)

1.  **登录**：退出当前账号，使用 `admin` / `admin123` 登录。
2.  **配送中心总览**：
    *   进入 **[配送中心总览]**。
    *   *验证*：应看到 `广州物流中心` 和 `深圳分拨中心` 的卡片。
    *   点击 `广州物流中心`，查看该中心下的所有车辆负载详情表格。

---

## 4. 常见问题排查

*   **数据库报错**：如果页面提示 Integrity Error 或 Trigger Error，请仔细阅读报错信息。通常是由于违反了业务规则（如车辆超载、司机车队不匹配）。
*   **状态未更新**：请确认是否点击了浏览器的刷新按钮，或数据修改是否成功提交。
*   **权限拒绝**：确保使用正确的账号登录（DP 开头为主管，DR 开头为司机）。
